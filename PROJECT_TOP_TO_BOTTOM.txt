LUMINA PROJECT - TOP TO BOTTOM WALKTHROUGH
==========================================

0) PROJECT IDENTITY
-------------------
Name:
- Lumina: Smart Home Energy Prediction & Monitoring System

Type:
- End-to-end prototype (Streamlit app + ML inference + live simulation)

Primary goal:
- Help users understand, monitor, and predict household electricity usage using AI + weather context.


1) REPOSITORY OVERVIEW
----------------------
Top-level key items:
- app.py                               -> Main Streamlit application
- src/                                 -> Core logic modules
- models/                              -> Trained model artifacts
- enhanced_datasets/                   -> Main prepared dataset
- archive_extracted/, datasets_extracted/ -> Raw/auxiliary datasets
- live_data_log.csv                    -> Persisted live telemetry logs
- save_ceew_model.py                   -> Main model training + save script
- train_ceew_br04.py, train_ceew_enhanced.py -> Additional training scripts
- Project_Report_Lumina.docx           -> Project documentation
- Project_Report_Lumina_50Pages.docx   -> Expanded report
- PROJECT_SUMMARY.txt                  -> concise summary


2) APP ENTRYPOINT FLOW (app.py)
-------------------------------
2.1 Startup
- Configures Streamlit page settings and custom CSS theme.
- Initializes constants:
  - LIVE_LOG_PATH
  - LIVE_LOG_COLUMNS
- Calls init_system() to load:
  - predictor (CEEW production model)
  - preprocessed dataframe from enhanced dataset

2.2 Historical + persisted live data merge
- Reads live_data_log.csv safely.
- Repairs malformed legacy CSV rows if needed.
- Converts power_kw to energy_kwh (assuming ~1 second interval).
- Appends recovered live energy values into main dataframe for charts.

2.3 Sidebar setup
- Branding + system status
- Location block (GPS + manual input)
- Live weather panel
- Configuration controls (tariff, compact mode)
- Chat assistant block
- Quick Demo Mode support (preload data for instant demos)

2.4 Main dashboard
- Hero header
- Date range filter
- Summary cards:
  - Total Consumption
  - Estimated Cost
  - Carbon Footprint
  - Daily Average

2.5 Tab modules
- Overview
- What-If Lab
- Live Telemetry
- Forecast
- Solar Planner


3) TAB-BY-TAB BEHAVIOR
----------------------
3.1 Overview tab
- Shows consumption trend (area + anomaly dots)
- Dynamic granularity:
  - detailed series for smaller filtered windows
  - daily aggregation for large windows
- Hourly heatmap by average energy_kwh

3.2 What-If Lab tab
- User controls weather/time/occupancy scenario
- Calls predictor.predict_one(...)
- Displays expected hourly energy + cost + demand state message

3.3 Live Telemetry tab
- Uses VirtualSmartMeter to generate simulated readings
- Device toggles alter load profile (HVAC/heater/EV)
- Performance controls:
  - refresh interval
  - samples per burst
  - chart points
- Appends standardized readings to live_data_log.csv
- Runs anomaly checks and shows alerts
- Supports live CSV/session CSV download

3.4 Forecast tab
- Fetches 24-hour weather forecast
- Runs model inference for each hour
- Stores forecast in session_state for export
- Displays projected total, peak hour energy, peak time
- Renders forecast area chart + peak marker
- Supports forecast CSV download

3.5 Solar Planner tab
- Uses live weather + system settings
- Calculates instant generation potential
- Estimates daily production and savings
- Computes ROI/breakeven style summary


4) DATASETS USED
----------------
4.1 Active dataset (main)
- enhanced_datasets/CEEW_BR04_with_weather.csv

4.2 Source dataset lineage
- archive_extracted/CEEW - Smart meter data Bareilly 2020.csv
  (meter BR04 data is key source)
- Weather context integrated from project weather data pipeline
  (includes datasets_extracted/dataset/WeatherData.csv context)

4.3 Data characteristics in active flow
- Time-indexed smart meter readings
- Weather variables aligned to timestamps
- Hourly resampling for app/model consistency


5) MODEL STACK
--------------
5.1 Active production model used by app
- Model: models/ceew_br04_production.h5
- Scaler: models/ceew_br04_scaler.pkl
- Features: models/ceew_br04_features.pkl
- Metadata: models/ceew_br04_metadata.pkl

5.2 Production metrics (from metadata)
- R2 score: 0.8921969491 (~89.22%)
- MAE: 0.0994245801 kWh
- Train records: 7452
- Test records: 828
- Date range: 2020-01-08 00:00:00 to 2020-12-31 23:00:00

5.3 Other artifacts present (legacy/experimental)
- dnn_CEEW_BR04.h5, dnn_model.h5, dnn_temporal.h5
- xgboost_model.pkl, xgb_temporal.pkl
- additional scaler and feature files


6) FEATURES USED IN ACTIVE FORECAST MODEL
-----------------------------------------
Total: 17 engineered features

Lag features:
- lag_1h
- lag_24h
- lag_168h

Rolling statistics:
- rolling_mean_24h
- rolling_std_24h

Temporal features:
- hour
- day_of_week
- month
- hour_sin
- hour_cos

Electrical features:
- z_Avg Voltage (Volt)
- z_Avg Current (Amp)
- y_Freq (Hz)

Weather features:
- temp
- humidity
- pressure
- wind_speed


7) CORE MODULES (src/)
----------------------
7.1 src/inference_ceew.py
- Loads production model/scaler/features
- Builds feature vector for single timestamp prediction
- Recursive multi-hour forecast generation

7.2 src/preprocessing_ceew.py
- Loads CEEW enhanced CSV
- Converts timestamp and index
- Resamples to hourly and renames for app compatibility

7.3 src/weather.py
- Live weather + forecast retrieval
- API key handling from secrets/env
- fallback logic when APIs fail
- reverse geocoding helper

7.4 src/virtual_meter.py
- Physics-inspired telemetry simulation
- Device state toggles influence power draw
- outputs voltage/current/power/pf/frequency

7.5 src/anomaly.py
- Detects:
  - instant spikes
  - night-time vampire load
  - sustained high load

7.6 src/solar.py
- Instant solar generation estimate
- Daily production estimate
- ROI-style economic estimate

7.7 src/chatbot.py
- Rule-based guidance responses


8) RECENT IMPROVEMENTS ADDED
----------------------------
- Encoding/mojibake cleanup in UI labels/icons
- Robust live CSV parser with malformed-row handling
- Fixed log schema for telemetry writes
- Production forecast recursion behavior improved
- Quick Demo Mode added
- Compact/mobile layout mode added
- CSV exports added (forecast + live)
- Telemetry performance controls added
- Tooltip help for live performance sliders


9) HOW TO RUN
-------------
9.1 Install dependencies
- pip install -r requirements.txt

9.2 Configure Weather API key (one method)
- .streamlit/secrets.toml
  WEATHER_API_KEY = "your_key"
- OR environment variable
  WEATHER_API_KEY=your_key

9.3 Launch app
- streamlit run app.py


10) EXPECTED USER JOURNEY
-------------------------
1. Open app
2. Confirm location/weather in sidebar
3. Select timeframe in Overview
4. Run What-If Lab scenario
5. Start Live Telemetry and watch behavior
6. Generate 24-hour forecast
7. Review Solar Planner estimate
8. Export forecast/live CSV for records


11) PROTOTYPE LIMITATIONS
-------------------------
- Live meter stream is simulated (not real hardware in current version)
- Forecast quality depends on training data coverage
- Utility-specific tariff slab intelligence is limited in current build


12) WHAT THIS PROJECT DEMONSTRATES
----------------------------------
- Practical integration of ML inference into a usable dashboard
- Robust handling of real-world prototype issues (bad logs, missing APIs)
- Clear path from data -> prediction -> visualization -> action/export
- Strong foundation for future production hardening and IoT integration

